{"mappings":"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","sources":["public/js/alerts.js","public/js/login.js","public/js/mapBox.js","public/js/updateSettings.js","public/js/stripe.js","public/js/index.js"],"sourcesContent":["//Type is 'success' or 'error'\r\n\r\nexport const hideAlert = () => {\r\n  const el = document.querySelector('.alert');\r\n  if (el) el.parentElement.removeChild(el);\r\n};\r\n\r\nexport const showAlert = (type, msg) => {\r\n  hideAlert();\r\n  const markup = `<div class=\"alert alert--${type}\">${msg}</div> `;\r\n  document.querySelector('body').insertAdjacentHTML('afterbegin', markup);\r\n  window.setTimeout(hideAlert, 5000 );\r\n};\r\n","import axios from 'axios';\r\nimport { showAlert } from './alerts';\r\n\r\nexport const login = async (email, password) => {\r\n  try {\r\n    const res = await axios({\r\n      method: 'POST',\r\n      url: '/api/v1/users/login',\r\n      data: {\r\n        email,\r\n        password,\r\n      },\r\n    });\r\n    if (res.data.status === 'success') {\r\n      showAlert('success', 'Logged in successfully!!');\r\n      window.setTimeout(() => {\r\n        location.assign('/');\r\n      }, 1500);\r\n    }\r\n  } catch (err) {\r\n    showAlert('error', err.response.data.message);\r\n  }\r\n};\r\n\r\nexport const logout = async () => {\r\n  try {\r\n    const res = await axios({\r\n      method: 'GET',\r\n      url: '/api/v1/users/logout',\r\n    });\r\n    if (res.data.status === 'success') {\r\n      location.reload(true);\r\n    }\r\n  } catch (err) {\r\n    showAlert('error', 'Error logging out ! Try again later.');\r\n  }\r\n};\r\n","\r\nexport const displayMap = (locations) => {\r\n  mapboxgl.accessToken =\r\n    'pk.eyJ1Ijoic3VyYWpzaGVsa2UiLCJhIjoiY2w0OGVvZGR4MGRiNTNqcWVkdjQwYmM0NyJ9.y6fkHMgPIF1ZuZP09Y_8_A';\r\n\r\n  var map = new mapboxgl.Map({\r\n    container: 'map',\r\n    style: 'mapbox://styles/surajshelke/cl48ffsv4002214p8g35dfy0s',\r\n    scrollZoom: false,\r\n    //   style: 'mapbox://styles/surajshelke/cl48fi754000y14ofy61or81q',\r\n  });\r\n\r\n  const bounds = new mapboxgl.LngLatBounds();\r\n\r\n  locations.forEach((loc) => {\r\n    // Create marker\r\n    const el = document.createElement('div');\r\n    el.className = 'marker';\r\n    new mapboxgl.Marker({\r\n      element: el,\r\n      anchor: 'bottom',\r\n    })\r\n      .setLngLat(loc.coordinates)\r\n      .addTo(map);\r\n\r\n    // New Popup\r\n    new mapboxgl.Popup({\r\n      offset: 30,\r\n    })\r\n      .setLngLat(loc.coordinates)\r\n      .setHTML(`<p>Day ${loc.day}: ${loc.description}</p>`)\r\n      .addTo(map);\r\n\r\n    // Extend map bounds to include current location\r\n    bounds.extend(loc.coordinates);\r\n  });\r\n\r\n  map.fitBounds(bounds, {\r\n    padding: {\r\n      top: 200,\r\n      bottom: 150,\r\n      left: 100,\r\n      right: 100,\r\n    },\r\n  });\r\n};\r\n","import axios from 'axios';\r\nimport { showAlert } from './alerts';\r\n\r\n// Type is either password or data\r\nexport const updateSettings = async (data, type) => {\r\n  try {\r\n    const url =\r\n      type === 'password'\r\n        ? '/api/v1/users/updateMyPassword'\r\n        : '/api/v1/users/updateMe';\r\n    const res = await axios({\r\n      method: 'PATCH',\r\n      url,\r\n      data,\r\n    });\r\n\r\n    if (res.data.status === 'success') {\r\n      showAlert('success', `${type.toUpperCase()} added successfully!`);\r\n    }\r\n  } catch (err) {\r\n    showAlert('error', err.response.data.message);\r\n  }\r\n};\r\n","import axios from 'axios';\r\nimport { showAlert } from './alerts';\r\n\r\nconst stripe = Stripe(\r\n  'pk_test_51LDfVNSGXebgq3gPTbn99N0Kf29sunuBncpQhnuVCbyH9BBLUCZKgp6OvLXtCFFpZCUot6TPmOdU2hQHxtI0K9RD00FDKWd443'\r\n);\r\n\r\nexport const bookTour = async (tourID) => {\r\n  try {\r\n    // Get checkout session from API\r\n    const session = await axios(\r\n      `/api/v1/bookings//checkout-session/${tourID}`\r\n    );\r\n    // console.log(session);\r\n    // Create checkout form + charge credit card\r\n    await stripe.redirectToCheckout({\r\n      sessionId: session.data.session.id,\r\n    });\r\n  } catch (err) {\r\n    showAlert('error', err);\r\n  }\r\n};\r\n","import '@babel/polyfill';\r\nimport { login, logout } from './login';\r\nimport { displayMap } from './mapBox';\r\nimport { updateSettings } from './updateSettings';\r\nimport { bookTour } from './stripe';\r\n\r\n//DOM ELEMENTS\r\nconst mapBox = document.getElementById('map');\r\nconst loginForm = document.querySelector('.form--login');\r\nconst logoutBtn = document.querySelector('.nav__el--logout');\r\nconst userDataForm = document.querySelector('.form-user-data');\r\nconst userPasswordForm = document.querySelector('.form-user-password');\r\nconst bookBtn = document.getElementById('book-tour');\r\n\r\n//VALUES\r\n\r\n//DELEGATION\r\nif (mapBox) {\r\n  const locations = JSON.parse(mapBox.dataset.locations);\r\n  displayMap(locations);\r\n}\r\n\r\nif (loginForm) {\r\n  document.querySelector('.form').addEventListener('submit', (e) => {\r\n    const email = document.getElementById('email').value;\r\n    const password = document.getElementById('password').value;\r\n    e.preventDefault();\r\n    login(email, password);\r\n  });\r\n}\r\n\r\nif (logoutBtn) {\r\n  logoutBtn.addEventListener('click', logout);\r\n}\r\n\r\nif (userDataForm) {\r\n  userDataForm.addEventListener('submit', (e) => {\r\n    e.preventDefault();\r\n    const form = new FormData();\r\n    form.append('name', document.getElementById('name').value);\r\n    form.append('email', document.getElementById('email').value);\r\n    form.append('photo', document.getElementById('photo').files[0]);\r\n    // console.log(form);\r\n\r\n    updateSettings(form, 'data');\r\n  });\r\n}\r\n\r\nif (userPasswordForm) {\r\n  userPasswordForm.addEventListener('submit', async (e) => {\r\n    e.preventDefault();\r\n    document.querySelector('.btn--save-password').textContent = 'Updating...';\r\n    const passwordCurrent = document.getElementById('password-current').value;\r\n    const password = document.getElementById('password').value;\r\n    const passwordConfirm = document.getElementById('password-confirm').value;\r\n    await updateSettings(\r\n      { passwordCurrent, password, passwordConfirm },\r\n      'password'\r\n    );\r\n    document.querySelector('.btn--save-password').textContent = 'Save password';\r\n    document.getElementById('password-current').value = '';\r\n    document.getElementById('password').value = '';\r\n    document.getElementById('password-confirm').value = '';\r\n  });\r\n}\r\n\r\nif (bookBtn) {\r\n  bookBtn.addEventListener('click', (e) => {\r\n    e.target.textContent = 'Processing...';\r\n    const tourID = e.target.dataset.tourId;\r\n    bookTour(tourID);\r\n  });\r\n}\r\n"],"names":["$7dc87b7f457e655a$export$516836c6a9dfc573","el","document","querySelector","parentElement","removeChild","$7dc87b7f457e655a$export$de026b00723010c1","type","msg","markup","insertAdjacentHTML","window","setTimeout","$bf5b431e6a69fea8$export$596d806903d1f59e","async","email","password","$parcel$interopDefault","$cnf0l$axios","method","url","data","status","location","assign","err","response","message","$5551cfcd014bd5f0$export$4c5dd147b21b9176","locations","mapboxgl","accessToken","map","Map","container","style","scrollZoom","bounds","LngLatBounds","forEach","loc","createElement","className","Marker","element","anchor","setLngLat","coordinates","addTo","Popup","offset","setHTML","day","description","extend","fitBounds","padding","top","bottom","left","right","$955535ce7513e32c$export$f558026a994b6051","toUpperCase","$9fd71c92b6f885af$var$stripe","Stripe","$9fd71c92b6f885af$export$8d5bdbf26681c0c2","tourID","session","redirectToCheckout","sessionId","id","$407eccdc61ba7a94$var$mapBox","getElementById","$407eccdc61ba7a94$var$loginForm","$407eccdc61ba7a94$var$logoutBtn","$407eccdc61ba7a94$var$userDataForm","$407eccdc61ba7a94$var$userPasswordForm","$407eccdc61ba7a94$var$bookBtn","JSON","parse","dataset","addEventListener","e","value","preventDefault","reload","form","FormData","append","files","textContent","passwordCurrent","passwordConfirm","target","tourId"],"version":3,"file":"index.js.map","sourceRoot":"../../../"}